#!/bin/sh
# Cross-platform pinentry fallback script
# Tries platform-specific pinentry programs with fallbacks

# Terminal-first fallbacks - prefer non-GUI pinentry programs
for pinentry_cmd in pinentry-curses pinentry-tty pinentry-gtk-2 pinentry-gtk pinentry-qt pinentry-qt4 pinentry-mac; do
  command -v "$pinentry_cmd" >/dev/null 2>&1 && exec "$pinentry_cmd" "$@"
done

# MacPorts alternatives (optional)
for pinentry_cmd in /opt/local/bin/pinentry-curses /opt/local/bin/pinentry-gtk2; do
  [ -x "$pinentry_cmd" ] && exec "$pinentry_cmd" "$@"
done

# Final fallback
echo "ERROR: No usable pinentry program found" 1>&2
echo "Please install a pinentry program:" 1>&2
echo "  macOS: sudo port install pinentry-mac" 1>&2
echo "  Linux: sudo apt-get install pinentry-gtk2 (or pinentry-curses)" 1>&2
exit 1
